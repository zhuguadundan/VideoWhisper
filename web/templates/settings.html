<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API设置 - 智能视频转文本处理平台</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <style>
        .security-notice {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            border-left: 4px solid #e17055;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
        }
        .api-section {
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background: rgba(255, 255, 255, 0.7);
        }
        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            border: none;
            background: none;
            color: #6c757d;
            cursor: pointer;
        }
        .test-button {
            width: 100%;
            margin-top: 10px;
        }
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-untested { background-color: #6c757d; }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- 导航 -->
                <div class="mb-4">
                    <a href="/" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left me-2"></i>返回首页
                    </a>
                </div>

                <!-- 标题 -->
                <div class="text-center mb-5">
                    <h1><i class="fas fa-cog me-3"></i>API设置</h1>
                    <p class="text-muted">配置您的AI服务API密钥和访问地址</p>
                </div>

                <!-- 安全提示 -->
                <div class="security-notice">
                    <h6><i class="fas fa-shield-alt me-2"></i>安全提醒</h6>
                    <ul class="mb-0">
                        <li>API密钥仅保存在您的浏览器本地存储中，不会上传到服务器</li>
                        <li>请定期更换API密钥以确保账户安全</li>
                        <li>建议使用专门的API子账户，限制权限范围</li>
                        <li>如在公共设备使用，请及时清除浏览器数据</li>
                    </ul>
                </div>

                <!-- 配置表单 -->
                <form id="apiConfigForm">
                    <!-- 语音识别API配置 -->
                    <div class="api-section">
                        <h5 class="mb-3">
                            <i class="fas fa-microphone me-2"></i>语音识别服务 (硅基流动)
                            <span class="status-indicator status-untested" id="siliconflow-status"></span>
                            <small class="text-muted" id="siliconflow-status-text">未测试</small>
                        </h5>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">API Key</label>
                                <div class="position-relative">
                                    <input type="password" class="form-control" id="siliconflow_api_key" 
                                           placeholder="输入硅基流动API Key">
                                    <button type="button" class="toggle-password" 
                                            onclick="togglePasswordVisibility('siliconflow_api_key')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Base URL</label>
                                <input type="url" class="form-control" id="siliconflow_base_url" 
                                       value="https://api.siliconflow.cn/v1" placeholder="API基础URL">
                            </div>
                            <div class="col-12">
                                <label class="form-label">模型名称</label>
                                <input type="text" class="form-control" id="siliconflow_model" 
                                       value="FunAudioLLM/SenseVoiceSmall" placeholder="语音识别模型">
                            </div>
                            <div class="col-12">
                                <button type="button" class="btn btn-outline-success test-button" 
                                        onclick="testConnection('siliconflow')">
                                    <i class="fas fa-check-circle me-2"></i>测试连接
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- OpenAI配置 -->
                    <div class="api-section">
                        <h5 class="mb-3">
                            <i class="fas fa-brain me-2"></i>OpenAI GPT
                            <span class="status-indicator status-untested" id="openai-status"></span>
                            <small class="text-muted" id="openai-status-text">未测试</small>
                        </h5>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">API Key</label>
                                <div class="position-relative">
                                    <input type="password" class="form-control" id="openai_api_key" 
                                           placeholder="输入OpenAI API Key">
                                    <button type="button" class="toggle-password" 
                                            onclick="togglePasswordVisibility('openai_api_key')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Base URL (可选)</label>
                                <input type="url" class="form-control" id="openai_base_url" 
                                       placeholder="留空使用默认地址">
                            </div>
                            <div class="col-12">
                                <label class="form-label">模型名称</label>
                                <input type="text" class="form-control" id="openai_model" 
                                       value="gpt-4" placeholder="OpenAI模型">
                            </div>
                            <div class="col-12">
                                <button type="button" class="btn btn-outline-success test-button" 
                                        onclick="testConnection('openai')">
                                    <i class="fas fa-check-circle me-2"></i>测试连接
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Gemini配置 -->
                    <div class="api-section">
                        <h5 class="mb-3">
                            <i class="fas fa-star me-2"></i>Google Gemini
                            <span class="status-indicator status-untested" id="gemini-status"></span>
                            <small class="text-muted" id="gemini-status-text">未测试</small>
                        </h5>
                        
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">API Key</label>
                                <div class="position-relative">
                                    <input type="password" class="form-control" id="gemini_api_key" 
                                           placeholder="输入Gemini API Key">
                                    <button type="button" class="toggle-password" 
                                            onclick="togglePasswordVisibility('gemini_api_key')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Base URL (可选)</label>
                                <input type="url" class="form-control" id="gemini_base_url" 
                                       placeholder="留空使用默认地址">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">模型名称</label>
                                <input type="text" class="form-control" id="gemini_model" 
                                       value="gemini-pro" placeholder="Gemini模型">
                            </div>
                            <div class="col-12">
                                <button type="button" class="btn btn-outline-success test-button" 
                                        onclick="testConnection('gemini')">
                                    <i class="fas fa-check-circle me-2"></i>测试连接
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 操作按钮 -->
                    <div class="text-center mt-4">
                        <button type="submit" class="btn btn-primary btn-lg me-3">
                            <i class="fas fa-save me-2"></i>保存配置
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-lg me-3" onclick="loadConfig()">
                            <i class="fas fa-refresh me-2"></i>重新加载
                        </button>
                        <button type="button" class="btn btn-outline-danger btn-lg" onclick="clearConfig()">
                            <i class="fas fa-trash me-2"></i>清除所有配置
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
</body>
</html>